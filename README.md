# HXC_Board_D_CAN_Temple_project
HXC战队D型开发板转CAN通信模块标准模板  
tips：当前使用HXC_CAN库2.0版本api  
## 一.基本设计框架
1.包含两种数据收发流程：同步收发、异步收发  
2.同步收发：即为收到数据后直接使用CAN模块将此数据发送出去，不进行处理  
3.异步收发：启动数据收发线程后，将接收到的数据同步到main函数内的全局变量，即为"main.cpp"文件中的'HXC_CAN_message_t'格式的'receive_msg'变量。  
4.包含以下几种线程：LED指示线程，数据收发线程，数据接收线程，CAN消息数据发送线程
## 二.基本数据类型
##### 本工程使用的是**HXC_CAN** api中提供的结构体变量类型
1.本工程中，使用"CAN_BUS(6,7)"语句来规定CAN模块的引脚。HXC_D型开发板的CAN模块引脚编号为"6,7"。若不同的开发板CAN模块引脚不同，则只需改变此函数内的数据"6,7"即可；其中，6对应的为CAN总线中的TX引脚，7对应的为RX引脚  
2.在本工程中，使用"led(4)"语句来规定LED所对应的引脚，本模板使用的是HXC_D型开发版，默认LED引脚为4  
3.本示例工程中使用的数据长度为标准帧的8字节（可自行更改使用拓展帧格式）  
2.使用时，只需引出结构体中的两种变量"identifier","data_length_code"，分别对应设备的"CAN标识"，"数据长度"；需要注意的是，数据长度一般为8字节，为CAN标准帧长度。  
3.本模板中，发送的数据中包含两种float类型数据（float类型为4字节，为满足发送的8字节长度，此为两种数据，若需要接受的为传感器数据为8字节，则只需一种即可）。  
4.本模板中发送的数据已给定，后续将添加数据接收工作。  
## 三.LED的四种指示状态
1.此模板规定“指示LED”包含四种工作状态：正常工作，CAN离线，设备离线，其他异常情况。  
2.正常工作状态（Normal）：LED呈现呼吸灯效果，并且LED最高亮度较低  
3.CAN离线状态（CanOutline）：LED呈现较亮一次快闪效果，即两次闪烁间隔时间相等  
4.设备离线状态（DeviceOutline）：指示LED呈现常高亮；设备离线为较高等级的异常，顾使用明显的高亮来指示此状态  
5.其他异常状态（Other）：指示LED呈现较亮二次快闪效果，即两次为一个周期，一个周期内闪烁间隔较短，两个周期间隔相对较大  
（后续若有更多的异常情况，将会拓展以上内容，以方便判断问题所在）  
## 四.关于工作流程
1.当模块启动后，会优先启动LED指示线程。  
2.启动前应选定收发模式，LED线程启动后会将会收发流程启动相应的线程。  
3.当此模块接收到数据后，将立即发送数据（间隔非常非常非常短）；若模块收发出现问题时，会使用LED的不同指示状态来指示出现的问题所在。
## 五.关于main函数及启动
在ESP32中main( )函数以setup( ) {"code"}来展现  
#### 以下为标准启动流程
1.首先启动LED指示线程，即使用"led.setup( );"语句。（注意：LED线程启动前应选择LED所对应的引脚，本模板使用的是HXC_D型开发版，默认LED引脚为4）  
2.接着，我们应该初始化ESP芯片自带的CAN模块，在本工程中，已经规定好启动使用的线程，故只需使用"CAN_BUS.setup( )"语句进行初始化即可。  
3.然后，就是启动数据收发线程了。根据需要，使用不同的收发模式来启动此模块。本模板工程提供了两种收发流程的启动示例，根据需要进行选择即可。注意删除不需要的启动流程。  
至此，模块启动完毕！在后续使用中，我们就可以根据不同LED状态来判断出现的问题。  
#####本模板尚存的一些未完成部分
1.收发线程以及发送线程中，需要发送的数据已经给定，即当前无法实现接收功能，只能发送给定的数据；后续将在更新中添加接收函数